@page
@model Authelp.Pages.MessagesModel

<div style="display:flex; height:600px;">

    
    <div style="width:250px; border-right:1px solid #ccc; padding:10px; overflow-y:auto;">
        <h3>Users</h3>
        @foreach (var u in Model.UserList)
        {
            <div style="padding:8px; cursor:pointer; border-bottom:1px solid #eee;">
                <a asp-page="/Messages" asp-route-ChatWithId="@u.Id">@u.Name</a>
            </div>
        }
    </div>

    
    <div style="flex:1; padding:20px; display:flex; flex-direction:column;">

        @if (!Model.ChatWithId.HasValue)
        {
            <h3>Select a user to start messaging</h3>
        }
        else
        {
            <div style="flex:1; overflow-y:auto; border:1px solid #ccc; padding:15px; border-radius:8px;">
                @foreach (var m in Model.Conversation)
                {
                    var isCurrentUser = m.SenderId == Model.CurrentUserId;
                    <div style="margin-bottom:10px;
                                background:@(isCurrentUser ? "#def" : "#eee");
                                padding:10px; border-radius:6px; width:fit-content;">
                        <strong>@(isCurrentUser ? "You" : m.Sender?.Name):</strong>
                        <br />
                        @m.Text
                        <br />
                        <small>@m.SentAt.ToLocalTime().ToString("g")</small>
                    </div>
                }
            </div>

            <form method="post" asp-page-handler="Send" style="margin-top:10px;">
                <input type="hidden" name="ChatWithId" value="@Model.ChatWithId" />
                <textarea asp-for="MessageText" rows="3"
                          style="width:100%; padding:10px; border-radius:6px;"></textarea>
                <button type="submit" style="margin-top:10px; padding:10px 20px;">Send</button>
            </form>
        }
    </div>
</div>
